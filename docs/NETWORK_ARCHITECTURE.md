# DailyMeal λ„¤νΈμ›ν¬ μ•„ν‚¤ν…μ²

## π—οΈ **λ„¤νΈμ›ν¬ κµ¬μ΅°λ„**

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ μ™Έλ¶€ λ„¤νΈμ›ν¬ (λ¨λ°”μΌ, λ‹¤λ¥Έ PC)                                β”‚
β”‚                                                             β”‚
β”‚  π“± Expo Go App                    π’» λΈλΌμ°μ €              β”‚
β”‚     β†“ http://192.168.219.103:3000    β†“                     β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                       β”‚
                       β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Windows Host (192.168.219.103)                              β”‚
β”‚                                                             β”‚
β”‚  π”€ Port Forwarding (netsh portproxy)                       β”‚
β”‚     192.168.219.103:3000 β†’ 172.21.114.94:3000             β”‚
β”‚     192.168.219.103:8000 β†’ 172.21.114.94:8000             β”‚
β”‚                       β”‚                                     β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ WSL2 Ubuntu (172.21.114.94)        β”‚                β”‚   β”‚
β”‚  β”‚                                    β†“                β”‚   β”‚
β”‚  β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚  β”‚ Frontend (Next.js)                          β”‚   β”‚   β”‚
β”‚  β”‚  β”‚ - Listen: 0.0.0.0:3000                     β”‚   β”‚   β”‚
β”‚  β”‚  β”‚ - CORS: localhost, 172.21.114.94           β”‚   β”‚   β”‚
β”‚  β”‚  β”‚ - Socket.IO Client β†’ Backend               β”‚   β”‚   β”‚
β”‚  β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚                                                     β”‚   β”‚
β”‚  β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚  β”‚ Backend (NestJS)                            β”‚   β”‚   β”‚
β”‚  β”‚  β”‚ - Listen: 0.0.0.0:8000                     β”‚   β”‚   β”‚
β”‚  β”‚  β”‚ - CORS: localhost, 172.21.114.94           β”‚   β”‚   β”‚
β”‚  β”‚  β”‚ - Socket.IO Server                          β”‚   β”‚   β”‚
β”‚  β”‚  β”‚ - SQLite: ./data/dev.sqlite                β”‚   β”‚   β”‚
β”‚  β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚   β”‚
β”‚  β”‚                                                     β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚                                                             β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π”„ **μ”μ²­ νλ¦„ μƒμ„Έ λ¶„μ„**

### **1. Expo Go μ•±μ—μ„ μ›Ή μ ‘μ†**

```
1. Expo Go App
   β†“ URL: http://192.168.219.103:3000
   
2. Windows Port Forwarding (μλ™)
   β†“ λ³€ν™: 192.168.219.103:3000 β†’ 172.21.114.94:3000
   
3. WSL2 Next.js μ„λ²„
   β†“ μμ‹ : 172.21.114.94:3000
   β†“ Origin ν—¤λ”: 172.21.114.94 λλ” null
   
4. CORS μ²΄ν¬
   β… 'http://172.21.114.94:3000' in allowed origins
   
5. μ‘λ‹µ λ°ν™
   β†“ λ™μΌ κ²½λ΅λ΅ μ—­μ μ „μ†΅
   
6. Expo WebView
   β… λ λ”λ§ μ™„λ£
```

### **2. λΈλΌμ°μ €μ—μ„ API νΈμ¶**

```
1. Next.js Frontend (λΈλΌμ°μ €)
   β†“ fetch(`${NEXT_PUBLIC_API_URL}/api/...`)
   β†“ NEXT_PUBLIC_API_URL=http://192.168.219.103:8000
   
2. Windows Port Forwarding (μλ™)
   β†“ λ³€ν™: 192.168.219.103:8000 β†’ 172.21.114.94:8000
   
3. WSL2 NestJS μ„λ²„
   β†“ μμ‹ : 172.21.114.94:8000
   β†“ Origin ν—¤λ”: http://172.21.114.94:3000
   
4. CORS μ²΄ν¬
   β… 'http://172.21.114.94:3000' in allowed origins
   
5. API μ‘λ‹µ λ°ν™
   β†“ JSON λ°μ΄ν„°
   
6. Frontend μ²λ¦¬
   β… μƒνƒ μ—…λ°μ΄νΈ
```

### **3. Socket.IO μ—°κ²°**

```
1. Next.js Frontend (Socket.IO Client)
   β†“ io(NEXT_PUBLIC_API_URL)
   β†“ URL: http://192.168.219.103:8000
   
2. Port Forwarding
   β†“ λ³€ν™: 192.168.219.103:8000 β†’ 172.21.114.94:8000
   
3. NestJS Socket.IO Server
   β†“ μμ‹ : 172.21.114.94:8000
   β†“ WebSocket Upgrade μ”μ²­
   
4. CORS μ²΄ν¬
   β… Origin ν—μ©
   
5. WebSocket μ—°κ²° μλ¦½
   β†” μ–‘λ°©ν–¥ μ‹¤μ‹κ°„ ν†µμ‹ 
   
6. μ΄λ²¤νΈ μ†΅μμ‹ 
   β… meal-created, meal-updated λ“±
```

---

## π― **ν•µμ‹¬ μ›λ¦¬**

### **μ™ μ„λ²„ μ„¤μ •μ— 192.168.219.103μ΄ λ¶ν•„μ”ν•κ°€?**

#### **Port Forwardingμ λ™μ‘ λ°©μ‹**
```bash
# Windowsμ—μ„ μ„¤μ • (netsh portproxy)
listenaddress=192.168.219.103 listenport=3000
connectaddress=172.21.114.94 connectport=3000
```

**μ΄ μ„¤μ •μ μλ―Έ:**
- π“¥ **μμ‹ **: Windows λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤(192.168.219.103)μ 3000 ν¬νΈ
- π“¤ **μ „λ‹¬**: WSL2(172.21.114.94)μ 3000 ν¬νΈλ΅ **ν¬λ…ν•κ²** μ „λ‹¬
- π”€ **λ³€ν™**: **TCP/IP κ³„μΈµ**μ—μ„ ν¨ν‚· μ£Όμ† μλ™ λ³€κ²½

#### **μ„λ²„κ°€ λ³΄λ” κ²ƒ**
```
ν΄λΌμ΄μ–ΈνΈ μ”μ²­ β†’ 192.168.219.103:3000
                β†“ (Port Forwarding)
μ„λ²„ μμ‹  β† 172.21.114.94:3000

μ„λ²„ μ…μ¥:
- Source IP: ν΄λΌμ΄μ–ΈνΈμ μ‹¤μ  IP (λλ” localhost)
- Destination IP: 172.21.114.94
- HTTP Origin Header: http://172.21.114.94:3000 (λΈλΌμ°μ €κ°€ μλ™ μ„¤μ •)
```

**κ²°λ΅ :**
- β… μ„λ²„λ” **172.21.114.94**λ΅ μ”μ²­μ„ λ°›μ
- β… CORS Origin ν—¤λ”λ„ **172.21.114.94** (λλ” localhost)
- β μ„λ²„λ” **192.168.219.103**λ¥Ό μ „ν€ λ¨λ¦„
- β CORSμ— 192.168.219.103 μ¶”κ°€λ” **λ¬΄μλ―Έ**

---

## π“ **μ„¤μ • κ°€μ΄λ“**

### **1. μ„λ²„ μ„¤μ • (λ°±μ—”λ“)**

**backend/src/main.ts**
```typescript
app.enableCors({
  origin: [
    'http://localhost:3000',       // β… WSL2 λ‚΄λ¶€ μ ‘μ†
    'http://172.21.114.94:3000',   // β… Port forwarding λ€μƒ
    // β 'http://192.168.219.103:3000' λ¶ν•„μ”!
  ],
  credentials: true,
})
```

### **2. μ„λ²„ μ„¤μ • (ν”„λ΅ νΈμ—”λ“)**

**frontend/next.config.js**
```javascript
images: {
  remotePatterns: [
    { hostname: 'localhost' },      // β… WSL2 λ‚΄λ¶€
    { hostname: '172.21.114.94' },  // β… Port forwarding λ€μƒ
    // β { hostname: '192.168.219.103' } λ¶ν•„μ”!
  ]
}
```

### **3. ν΄λΌμ΄μ–ΈνΈ μ„¤μ •**

**frontend/.env.local (Windows λ„¤νΈμ›ν¬ ν…μ¤νΈμ©)**
```bash
# β… ν΄λΌμ΄μ–ΈνΈλ” Windows IP μ‚¬μ©
NEXT_PUBLIC_API_URL=http://192.168.219.103:8000
NEXT_PUBLIC_SITE_URL=http://192.168.219.103:3000
```

**app/App.js (Expo)**
```javascript
const WEB_URL = __DEV__ 
  ? 'http://192.168.219.103:3000'  // β… ν΄λΌμ΄μ–ΈνΈλ” Windows IP
  : 'https://ec2-43-202-215-27.ap-northeast-2.compute.amazonaws.com'
```

---

## π§ **ν…μ¤νΈ μ‹λ‚λ¦¬μ¤**

### **μ‹λ‚λ¦¬μ¤ 1: WSL2 λ‚΄λ¶€ κ°λ°**
```bash
# μ„λ²„ μ‹μ‘
npm run dev:pm2

# λΈλΌμ°μ €
http://localhost:3000 β…

# ν™κ²½λ³€μ
NEXT_PUBLIC_API_URL=http://localhost:8000
```

### **μ‹λ‚λ¦¬μ¤ 2: Windows λΈλΌμ°μ € ν…μ¤νΈ**
```bash
# μ„λ²„ μ‹μ‘ (WSL2)
npm run dev:pm2

# λΈλΌμ°μ € (Windows)
http://192.168.219.103:3000 β…

# ν™κ²½λ³€μ (.env.local)
NEXT_PUBLIC_API_URL=http://192.168.219.103:8000
```

### **μ‹λ‚λ¦¬μ¤ 3: Expo Go μ•±**
```bash
# μ„λ²„ μ‹μ‘ (WSL2)
npm run dev:pm2

# Expo μ‹μ‘ (WSL2)
cd app
REACT_NATIVE_PACKAGER_HOSTNAME=192.168.219.103 npx expo start

# Expo Go μ•±
QR μ½”λ“ μ¤μΊ” β…
WebView: http://192.168.219.103:3000
```

### **μ‹λ‚λ¦¬μ¤ 4: EC2 ν”„λ΅λ•μ…**
```bash
# EC2μ—μ„
export NEXT_PUBLIC_API_URL=https://ec2-43-202-215-27...
npm run build
pm2 restart all

# Nginx λ¦¬λ²„μ¤ ν”„λ΅μ‹
proxy_pass http://localhost:3000; β… (EC2 λ‚΄λ¶€)
```

---

## β… **μ²΄ν¬λ¦¬μ¤νΈ**

### **μ„λ²„ μ„¤μ •**
- [ ] β… Backend CORS: `localhost`, `172.21.114.94` ν¬ν•¨
- [ ] β Backend CORS: `192.168.219.103` **μ μ™Έ**
- [ ] β… Next.js Images: `localhost`, `172.21.114.94` ν¬ν•¨
- [ ] β Next.js Images: `192.168.219.103` **μ μ™Έ**
- [ ] β… μ„λ²„ Listen: `0.0.0.0:3000`, `0.0.0.0:8000`

### **ν΄λΌμ΄μ–ΈνΈ μ„¤μ •**
- [ ] β… Windows ν…μ¤νΈ: `NEXT_PUBLIC_API_URL=http://192.168.219.103:8000`
- [ ] β… Expo App.js: `http://192.168.219.103:3000` (κ°λ° λ¨λ“)
- [ ] β… Expo Metro: `REACT_NATIVE_PACKAGER_HOSTNAME=192.168.219.103`

### **Port Forwarding**
- [ ] β… `netsh portproxy` μ„¤μ • ν™•μΈ
- [ ] β… Windows λ°©ν™”λ²½ 3000, 8000 ν¬νΈ ν—μ©
- [ ] β… `Test-NetConnection` μ—°κ²° ν™•μΈ

---

## π“ **ν•™μµ ν¬μΈνΈ**

1. **Port Forwarding β‰  Proxy**
   - Port forwardingμ€ **TCP/IP κ³„μΈµ** λ³€ν™
   - μ„λ²„λ” μµμΆ… λ©μ μ§€ IPλ§ μΈμ‹
   - μ¤‘κ°„ κ²½λ΅ IPλ” μ„λ²„κ°€ λ¨λ¦„

2. **CORSλ” Origin ν—¤λ” κΈ°λ°**
   - λΈλΌμ°μ €κ°€ μλ™μΌλ΅ Origin ν—¤λ” μ¶”κ°€
   - Origin = μ›Ήνμ΄μ§€κ°€ **λ΅λ“λ** URL
   - Port forwarding ν›„ μµμΆ… μ£Όμ†κ°€ Origin

3. **0.0.0.0 Listenμ μλ―Έ**
   - λ¨λ“  λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤μ—μ„ μμ‹ 
   - localhost, 172.21.114.94, κΈ°νƒ€ IP λ¨λ‘ κ°€λ¥
   - λ³΄μ•μ„ μ„ν•΄ ν”„λ΅λ•μ…μ—μ„λ” νΉμ • IP μ§€μ • κ¶μ¥

---

## π‰ **κ²°λ΅ **

**ν•µμ‹¬ μ”μ•½:**
- β… ν΄λΌμ΄μ–ΈνΈ: `192.168.219.103` μ‚¬μ©
- β… Port Forwarding: μλ™ λ³€ν™
- β… μ„λ²„ μ„¤μ •: `172.21.114.94` μ‚¬μ©
- β μ„λ²„ μ„¤μ •: `192.168.219.103` λ¶ν•„μ”

**μ΄μ  λ„¤νΈμ›ν¬ κµ¬μ΅°λ¥Ό μ™„λ²½ν•κ² μ΄ν•΄ν–μµλ‹λ‹¤!** π“
