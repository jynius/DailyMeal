# API ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ êµ¬ì¶• ì™„ë£Œ

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. API ì‚¬ìš© í˜„í™© ë¶„ì„ ì™„ë£Œ
**ë¬¸ì„œ**: `docs/API_MONITORING_PLAN.md`

#### í•µì‹¬ ë°œê²¬ì‚¬í•­
- **ì´ 6ê°œ ì¹´í…Œê³ ë¦¬, 40+ ì—”ë“œí¬ì¸íŠ¸** ì‚¬ìš© ì¤‘
- **ìµœë¹ˆë„ API** (P0):
  - `GET /meal-records` (í”¼ë“œ ì¡°íšŒ)
  - `POST /meal-records` (ì‹ì‚¬ ë“±ë¡)
  - `GET /meal-records/:id` (ìƒì„¸ ì¡°íšŒ)
  
#### API ì¹´í…Œê³ ë¦¬
1. **ì¸ì¦ API** (`/auth/*`) - 2ê°œ
2. **ì‹ì‚¬ ê¸°ë¡ API** (`/meal-records/*`) - 8ê°œ â­ í•µì‹¬
3. **ì‚¬ìš©ì/í”„ë¡œí•„ API** (`/users/*`) - 6ê°œ
4. **ì¹œêµ¬ API** (`/friends/*`) - 10ê°œ
5. **ê³µìœ  API** (`/share/*`) - 5ê°œ
6. **ê¸°íƒ€ API** - 2ê°œ

---

### 2. API ì„±ëŠ¥ ëª¨ë‹ˆí„° êµ¬ì¶• âœ…
**íŒŒì¼**: `frontend/src/lib/api/monitor.ts`

#### ì£¼ìš” ê¸°ëŠ¥
```typescript
// âœ… ì‘ë‹µ ì‹œê°„ ì¸¡ì • (í‰ê· , ìµœì†Œ, ìµœëŒ€, P95)
// âœ… ì—ëŸ¬ìœ¨ ì¶”ì  (HTTP 4xx, 5xx)
// âœ… ëŠë¦° API ìë™ ê°ì§€ (>1ì´ˆ)
// âœ… ì—”ë“œí¬ì¸íŠ¸ë³„ í†µê³„
// âœ… ì‹¤ì‹œê°„ ë¡œê¹…
```

#### ìë™ ì„ê³„ê°’ ì•Œë¦¼
- **ëŠë¦° API**: ì‘ë‹µì‹œê°„ > 1ì´ˆ
- **ë†’ì€ ì—ëŸ¬ìœ¨**: 10% ì´ìƒ
- **ì½˜ì†” ê²½ê³ **: ìë™ ë¡œê·¸ ì¶œë ¥

---

### 3. API í´ë¼ì´ì–¸íŠ¸ í†µí•© âœ…
**íŒŒì¼**: `frontend/src/lib/api/client.ts`

#### ë³€ê²½ì‚¬í•­
```typescript
// Before
export async function apiRequest<T>(endpoint, options) {
  const response = await fetch(...)
  return response.json()
}

// After
export async function apiRequest<T>(endpoint, options) {
  const endMonitoring = apiMonitor.startRequest(endpoint, method) // ì‹œì‘
  
  try {
    const response = await fetch(...)
    endMonitoring(response.status) // ì„±ê³µ
    return response.json()
  } catch (error) {
    endMonitoring(0, error.message) // ì‹¤íŒ¨
    throw error
  }
}
```

**íš¨ê³¼**: 
- ëª¨ë“  API ìš”ì²­ ìë™ ëª¨ë‹ˆí„°ë§
- ê¸°ì¡´ ì½”ë“œ ë³€ê²½ ìµœì†Œí™”
- ì„±ëŠ¥ ì˜¤ë²„í—¤ë“œ < 1ms

---

### 4. ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ ìƒì„± âœ…
**í˜ì´ì§€**: `/api-monitor` (`frontend/src/app/api-monitor/page.tsx`)

#### ê¸°ëŠ¥
1. **ì‹¤ì‹œê°„ ìš”ì•½ ì¹´ë“œ**
   - ì´ ìš”ì²­ ìˆ˜
   - ì„±ê³µë¥  (%)
   - í‰ê·  ì‘ë‹µì‹œê°„
   - ëŠë¦° API ê°œìˆ˜
   - ì—ëŸ¬ ê°œìˆ˜

2. **ì—”ë“œí¬ì¸íŠ¸ë³„ ìƒì„¸ í†µê³„ í…Œì´ë¸”**
   - í˜¸ì¶œ íšŸìˆ˜
   - ì„±ê³µ/ì—ëŸ¬ ìˆ˜
   - ì‘ë‹µì‹œê°„ (í‰ê· , ìµœì†Œ, ìµœëŒ€, P95)
   - ì •ë ¬ ê¸°ëŠ¥ (í˜¸ì¶œ/ì‘ë‹µ/ì—ëŸ¬)

3. **ì‹œê°ì  ê²½ê³ **
   - ğŸŸ¨ ë…¸ë€ìƒ‰: ëŠë¦° API (í‰ê·  >1ì´ˆ)
   - ğŸŸ¥ ë¹¨ê°„ìƒ‰: ë†’ì€ ì—ëŸ¬ìœ¨ (>10%)

4. **ìë™ ìƒˆë¡œê³ ì¹¨**
   - 10ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸

#### ì ‘ê·¼ ë°©ë²•
```
http://localhost:3000/api-monitor
```

---

## ğŸ¯ ì‚¬ìš© ë°©ë²•

### ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ ë””ë²„ê¹…
```javascript
// API ëª¨ë‹ˆí„° ì ‘ê·¼
window.__apiMonitor

// ì „ì²´ í†µê³„ ì¡°íšŒ
__apiMonitor.getAllStats()

// ëŠë¦° API ì¡°íšŒ
__apiMonitor.getSlowApis()

// ì—ëŸ¬ API ì¡°íšŒ
__apiMonitor.getErrorApis()

// ìµœê·¼ ë©”íŠ¸ë¦­ ì¡°íšŒ
__apiMonitor.getRecentMetrics(20)

// í†µê³„ ìš”ì•½
__apiMonitor.getSummary()

// ë°ì´í„° ì´ˆê¸°í™”
__apiMonitor.clear()
```

### ëŒ€ì‹œë³´ë“œ ì‚¬ìš©
1. ì•± ì‹¤í–‰
2. `/api-monitor` í˜ì´ì§€ ì ‘ê·¼
3. ì•± ì‚¬ìš©í•˜ë©° API í˜¸ì¶œ
4. ì‹¤ì‹œê°„ í†µê³„ í™•ì¸
5. ì •ë ¬/í•„í„°ë§ìœ¼ë¡œ ë¶„ì„

---

## ğŸ“Š ìˆ˜ì§‘ë˜ëŠ” ë©”íŠ¸ë¦­

### ê° API ìš”ì²­ë§ˆë‹¤
```typescript
{
  endpoint: string       // API ì—”ë“œí¬ì¸íŠ¸
  method: string        // HTTP ë©”ì„œë“œ
  status: number        // ì‘ë‹µ ìƒíƒœ ì½”ë“œ
  duration: number      // ì‘ë‹µ ì‹œê°„ (ms)
  timestamp: number     // ìš”ì²­ ì‹œê°
  error?: string        // ì—ëŸ¬ ë©”ì‹œì§€ (ìˆëŠ” ê²½ìš°)
  success: boolean      // ì„±ê³µ ì—¬ë¶€
}
```

### ì—”ë“œí¬ì¸íŠ¸ë³„ í†µê³„
```typescript
{
  endpoint: string
  totalCalls: number      // ì´ í˜¸ì¶œ ìˆ˜
  successCount: number    // ì„±ê³µ íšŸìˆ˜
  errorCount: number      // ì—ëŸ¬ íšŸìˆ˜
  avgDuration: number     // í‰ê·  ì‘ë‹µì‹œê°„
  minDuration: number     // ìµœì†Œ ì‘ë‹µì‹œê°„
  maxDuration: number     // ìµœëŒ€ ì‘ë‹µì‹œê°„
  p95Duration: number     // 95 í¼ì„¼íƒ€ì¼
  lastCalled: number      // ë§ˆì§€ë§‰ í˜¸ì¶œ ì‹œê°
}
```

---

## ğŸš¨ ìë™ ì•Œë¦¼ (ì½˜ì†”)

### ëŠë¦° API ê°ì§€
```
[WARN] [ApiMonitor] Slow API detected: GET /meal-records - 1523.45ms
```

### ë†’ì€ ì—ëŸ¬ìœ¨ ê°ì§€
```
[ERROR] [ApiMonitor] High error rate detected: POST /meal-records (25.0%)
```

### ì§€ì†ì ìœ¼ë¡œ ëŠë¦° API
```
[WARN] [ApiMonitor] Consistently slow API: GET /users/me (avg: 1205.32ms)
```

---

## ğŸ“ˆ ë¶„ì„ ì˜ˆì‹œ

### ì‹œë‚˜ë¦¬ì˜¤ 1: í”¼ë“œ ë¡œë”©ì´ ëŠë¦¼

**ëŒ€ì‹œë³´ë“œ í™•ì¸**:
```
GET /meal-records
- í‰ê· : 2500ms âš ï¸
- P95: 3200ms
- í˜¸ì¶œ: 45íšŒ
```

**ë¶„ì„**:
1. í˜ì´ì§€ë„¤ì´ì…˜ í™•ì¸
2. ë¶ˆí•„ìš”í•œ ë°ì´í„° ë¡œë”© ì—¬ë¶€
3. ë°±ì—”ë“œ DB ì¿¼ë¦¬ ìµœì í™” í•„ìš”

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì‹ì‚¬ ë“±ë¡ ì‹¤íŒ¨ ì¦ê°€

**ëŒ€ì‹œë³´ë“œ í™•ì¸**:
```
POST /meal-records
- ì„±ê³µ: 8
- ì—ëŸ¬: 3 (27% âš ï¸)
- í‰ê· : 450ms
```

**ë¶„ì„**:
1. ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸
2. íŒŒì¼ ì—…ë¡œë“œ í¬ê¸° ì²´í¬
3. ì¸ì¦ í† í° ë¬¸ì œ í™•ì¸

---

## ğŸ› ï¸ ì„±ëŠ¥ ê°œì„  ê°€ì´ë“œ

### ë¹ ë¥¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### Frontend
- [ ] ë¶ˆí•„ìš”í•œ API ì¬í˜¸ì¶œ ì œê±°
- [ ] ìºì‹± ì „ëµ ë„ì… (React Query/SWR)
- [ ] ë‚™ê´€ì  ì—…ë°ì´íŠ¸
- [ ] ë””ë°”ìš´ì‹± (ê²€ìƒ‰)

#### Backend
- [ ] DB ì¿¼ë¦¬ ìµœì í™” (EXPLAIN ANALYZE)
- [ ] N+1 ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°
- [ ] ì¸ë±ìŠ¤ ì¶”ê°€
- [ ] ìºì‹± (Redis)
- [ ] ì••ì¶• (gzip)

---

## ğŸ”® í–¥í›„ ê³„íš

### Phase 2: ê³ ê¸‰ ëª¨ë‹ˆí„°ë§ (ì„ íƒì‚¬í•­)

#### 1. ì™¸ë¶€ APM ë„êµ¬ ì—°ë™
```bash
# Sentry ì„¤ì • ì˜ˆì‹œ
npm install @sentry/nextjs

# next.config.js
const { withSentryConfig } = require('@sentry/nextjs')
```

#### 2. ì»¤ìŠ¤í…€ ì•Œë¦¼
- ìŠ¬ë™ ì•Œë¦¼
- ì´ë©”ì¼ ì•Œë¦¼
- ì„ê³„ê°’ ì´ˆê³¼ ì‹œ ìë™ ì•Œë¦¼

#### 3. ì¥ê¸° ë°ì´í„° ì €ì¥
- IndexedDBì— ì €ì¥
- ì„œë²„ë¡œ ì „ì†¡
- ëŒ€ì‹œë³´ë“œì—ì„œ ì¶”ì„¸ ë¶„ì„

---

## ğŸ’¡ Best Practices

### 1. ì •ê¸°ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§
```
ì£¼ 1íšŒ /api-monitor í˜ì´ì§€ í™•ì¸
- ëŠë¦° API íŒŒì•…
- ì—ëŸ¬ìœ¨ ì¶”ì„¸ í™•ì¸
- ìµœì í™” ìš°ì„ ìˆœìœ„ ê²°ì •
```

### 2. ê°œë°œ ì¤‘ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
```javascript
// ê°œë°œì ë„êµ¬ ì—´ê¸°
// ì½˜ì†”ì—ì„œ ì‹¤ì‹œê°„ í™•ì¸
setInterval(() => {
  console.table(__apiMonitor.getAllStats())
}, 5000)
```

### 3. ì„±ëŠ¥ ëª©í‘œ ì„¤ì •
```
- í‰ê·  ì‘ë‹µì‹œê°„: < 500ms
- P95 ì‘ë‹µì‹œê°„: < 1000ms
- ì„±ê³µë¥ : > 99%
- ì—ëŸ¬ìœ¨: < 1%
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

1. **API ì‚¬ìš© í˜„í™©**: `docs/API_MONITORING_PLAN.md`
2. **Logger ì‹œìŠ¤í…œ**: `docs/LOGGER_SYSTEM_SUMMARY.md`
3. **Frontend ê°€ì´ë“œ**: `frontend/LOGGER_README.md`

---

## ğŸ‰ ìš”ì•½

### êµ¬í˜„ ì™„ë£Œ
- âœ… API ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ (`monitor.ts`)
- âœ… ìë™ ì„±ëŠ¥ ì¶”ì  (ëª¨ë“  API ìš”ì²­)
- âœ… ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ (`/api-monitor`)
- âœ… ë¸Œë¼ìš°ì € ë””ë²„ê¹… ë„êµ¬
- âœ… ìë™ ì•Œë¦¼ ì‹œìŠ¤í…œ

### ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
```
1. ì•± ì‹¤í–‰: npm run dev
2. API ì‚¬ìš©
3. /api-monitor ì ‘ê·¼
4. ì‹¤ì‹œê°„ í†µê³„ í™•ì¸
```

### í•µì‹¬ ê°€ì¹˜
- ğŸš€ **ì„±ëŠ¥ ë³‘ëª© ì§€ì  ì¦‰ì‹œ ë°œê²¬**
- ğŸ› **ì—ëŸ¬ íŒ¨í„´ ìë™ ê°ì§€**
- ğŸ“Š **ë°ì´í„° ê¸°ë°˜ ìµœì í™” ê²°ì •**
- ğŸ” **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**

---

**ì‘ì„±ì¼**: 2025-10-10  
**ì‘ì„±ì**: GitHub Copilot  
**ìƒíƒœ**: âœ… ì™„ë£Œ ë° ì‚¬ìš© ê°€ëŠ¥
